<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>مسوقي مؤسسة "كن أنت" للتدريب والتأهيل</title>

  <link rel="stylesheet" href="../assets/fonts/tajawal.css">

  <meta property="og:title" content="مؤسسة كن أنت للتدريب والتأهيل" />
  <meta property="og:description" content="انضم لمسوقي مؤسسة كن أنت وكن جزءًا من صناعة القادة. سجل بياناتك الآن لتبدأ رحلتك معنا." />
  <meta property="og:image" content="https://skillia.netlify.app/images/photo.jpg" />
  <meta property="og:url" content="https://sklilia.netlify.app/Trainees_Records" />
  <meta property="og:type" content="website" />
  <meta property="og:locale" content="ar_AR" />

  <style>
    /* الألوان والخطوط */
    :root {
      --primary-color: #0d3b14; /* أخضر داكن */
      --secondary-color: #e5a72d; /* ذهبي */
      --accent-color: #f7f3e9; /* بيج فاتح */
      --text-color-dark: #2d3748;
      --muted-color: #4a5568;
      --white-color: #ffffff;
      --border-radius-lg: 20px;
    }


    /* Keyframes لتأثير Fade-in للنموذج */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    body{
      font-family: "Tajawal", sans-serif;
      background: linear-gradient(120deg, #f7f3e9, #eaf0f5);
      margin:0; padding:24px;
      display:flex; justify-content:center; align-items:center;
      min-height:100vh; color: var(--text-color-dark);
    }

    .container{width:100%;max-width:760px}
    .card{
      background:var(--white-color);
      border-radius:var(--border-radius-lg);
      box-shadow:0 12px 40px rgba(0,0,0,0.12);
      overflow:hidden;
    }

    header{
      background: var(--primary-color);
      color:#fff;
      padding:30px;
      /* تعديل العنوان في وضع الشروط */
      padding-top: calc(30px + env(safe-area-inset-top, 0px));
      text-align:center;
    }
    header h1{margin:0; font-size:24px; font-weight:800}

    .content{
      padding:30px;
      /* الحل لمعالجة قص العنوان في النموذج */
      padding-top: calc(30px + env(safe-area-inset-top, 0px));
    }

    .terms{
      max-height:420px; overflow:auto; padding:20px;
      border-radius:15px;
      background:var(--accent-color);
      border: 1px solid rgba(13, 59, 20, 0.1);
    }
    .terms h3{color:var(--primary-color); margin-top:0;}
    .terms ol li strong{color:var(--secondary-color)}

    /* تنسيق الأزرار */
    button {
      cursor:pointer;
      border:0;
      font-weight:700;
      transition: background 0.3s, transform 0.1s;
      padding:12px 20px;
      border-radius:15px; 
    }
    button:active { transform: translateY(1px); }

    .btn-accept {
      background:var(--primary-color);
      color:var(--white-color);
      box-shadow: 0 4px 12px rgba(13, 59, 20, 0.2);
    }
    .btn-accept:hover:not(:disabled) { background: #1a5c24; }
    
    /* تنسيق زر الإرسال المعطل */
    .btn-accept:disabled {
        background-color: #ccc !important;
        cursor: not-allowed;
        box-shadow: none;
        transform: none;
    }


    .btn-decline { 
      background:var(--accent-color);
      color:var(--primary-color);
      border: 1px solid var(--primary-color);
    }
    .btn-decline:hover { background: #e5e0d6; }

    /* تنسيق قسم الموافقة (Checkbox) */
    .actions {
        display:flex;
        align-items:center;
        gap:10px;
        margin-top:20px;
        flex-wrap: wrap;
    }
    
    /* تنسيق الـ Checkbox ليناسب التصميم */
    .styled-checkbox {
      width: 20px;
      height: 20px;
      appearance: none; /* إخفاء الشكل الافتراضي */
      border: 2px solid var(--primary-color);
      border-radius: 6px;
      background-color: var(--white-color);
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .styled-checkbox:checked {
      background-color: var(--primary-color);
      border-color: var(--primary-color);
    }

    /* رمز التأشير (checkmark) */
    .styled-checkbox:checked::after {
      content: '✓';
      color: var(--white-color);
      font-size: 14px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .approval-label {
        font-weight: bold;
        color: var(--text-color-dark);
        cursor: pointer;
        user-select: none;
    }

    form{
        display:none; 
        padding:20px 0; 
        border-top:1px solid #eef2f7;
        animation: fadeIn 0.4s ease-out forwards;
    }
    form h3{color:var(--secondary-color)}

    .row{display:flex; gap:15px; margin-bottom:15px;}
    .col{flex:1;}
    label{display:block;font-size:14px;color:var(--muted-color);margin-bottom:6px;}
    input,select{
      width:100%; padding:14px; border-radius:15px;
      border:1px solid #e6eef8; background:#fff; font-size:15px;
      transition:border-color 0.3s, background-color 0.3s; 
    }
    /* تعديل التركيز على المدخلات */
    input:focus, select:focus{
      border-color:var(--primary-color); 
      background-color: var(--accent-color); 
      outline:none; 
      box-shadow: none;
    }

    .note{font-size:13px;color:var(--muted-color);margin-top:15px}

    .success{
      display:none; padding:18px; background:#d4edda; color:#155724;
      border-radius:10px; margin-top:15px;
      font-weight: bold;
    }
    .error{
      display:none; padding:18px; background:#f8d7da; color:#721c24;
      border-radius:10px; margin-top:15px;
    }
    
    /* رسالة الترحيب عند التسجيل المسبق */
    #welcomeMessage {
        padding: 30px;
        text-align: center;
        background: #e6f7ff;
        border: 1px solid #91d5ff;
        border-radius: 15px;
        margin-top: 20px;
        color: var(--primary-color);
        font-weight: bold;
        display: none;
    }

    @media (max-width:600px){.row{flex-direction:column}}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <h1>الشروط والأحكام - مسوقي مؤسسة "كن أنت"</h1>
      </header>
      <div class="content">
        <div id="termsSection">
          <div class="terms">
            <h3>الشروط العامة للمسوقين</h3>
            <ol>
              <li><strong>الأهلية:</strong> يحق لأي شخص بالغ الانضمام كمسوق للمؤسسة، مع الالتزام بالقيم المهنية والمعايير الأخلاقية العالية.</li>
              <li><strong>الهدف:</strong> نشر الوعي بالدورات والبرامج التأهيلية للمؤسسة وتشجيع المهتمين على التسجيل.</li>
              <li><strong>بيانات المسوق:</strong> يجب تقديم بيانات صحيحة وحقيقية، ويتحمل المسوق المسؤولية الكاملة عن أي معلومات يقدمها.</li>
              <li><strong>طرق الترويج:</strong> التواصل الاجتماعي، البريد، مجموعات واتساب وتليجرام، والإعلانات الرقمية المشروعة. يمنع المحتوى المضلل أو الكاذب.</li>
              <li><strong>روابط الإحالة:</strong> يتم استخدام الرابط والكود الشخصي للترويج للبرامج فقط.</li>
              <li><strong>العمولات والمكافآت:</strong> تُصرف بعد التأكد من صحة التسجيلات.</li>
              <li><strong>المسؤولية:</strong> يتحمل المسوق كامل المسؤولية ويلتزم بالقوانين وقيم المؤسسة.</li>
              <li><strong>إنهاء التعاون:</strong> للمؤسسة الحق بإنهاء التعاون عند المخالفة.</li>
              <li><strong>تعديل الشروط:</strong> تحتفظ المؤسسة بحق تعديل الشروط وإخطار المسوقين عبر الوسائل الرسمية.</li>
            </ol>
            <p class="note">بالموافقة على الشروط، أنت توافق على تمثيل مؤسسة "كن أنت" بمهنية وأمانة.</p>
          </div>

          <div class="actions">
            <input type="checkbox" id="acceptCheckbox" class="styled-checkbox">
            <label for="acceptCheckbox" class="approval-label">أوافق على الشروط والأحكام</label>
          </div>
        </div>

        <form id="signupForm">
          <h3>سجّل بياناتك للحصول على رابط إحالة خاص بك</h3>
          <div class="row">
            <div class="col">
              <label for="fullname">الاسم الثلاثي</label>
              <input id="fullname" name="fullname" placeholder="مثال: عبدالله علي محسن" required />
            </div>
          </div>
          <div class="row">
            <div class="col">
              <label for="gender">الجنس</label>
              <select id="gender" name="gender" required>
                <option value="">اختر الجنس</option>
                <option value="ذكر">ذكر</option>
                <option value="إنثى">إنثى</option>
                <option value="آخر">آخر</option>
              </select>
            </div>
            <div class="col">
              <label for="country">البلد</label>
              <select id="country" name="country" required>
                <option value="">اختر البلد</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <label for="phone">رقم الهاتف (WhatsApp)</label>
              <input id="phone" name="phone" type="tel" placeholder="+9677xxxxxxx" pattern="[+0-9\s-]{6,20}" required />
            </div>
            <div class="col">
              <label for="email">البريد الإلكتروني</label>
              <input id="email" name="email" type="email" placeholder="name@example.com" required />
            </div>
          </div>
          <div style="display:flex;gap:10px;align-items:center;margin-top:15px">
            <button type="submit" class="btn-accept" id="submitBtn">إرسال وتسجيل</button>
            <button type="button" class="btn-decline" id="backBtn">العودة للشروط</button>
          </div>
          <div class="success" id="successBox">تم الإرسال بنجاح! شكرًا لتسجيلك. *سيتم توجيهك الآن إلى واتساب لإرسال نسخة.*</div>
          <div class="error" id="errorBox"></div>
        </form>
        
        <div id="welcomeMessage">
            <h3>مرحباً بك مجدداً!</h3>
            <p>لقد تم تسجيل بياناتك بنجاح مسبقاً. تم حفظ حالة تسجيلك لمنع التكرار.</p>
            <p>يرجى مراجعة رسالة الواتساب التي أرسلناها إليك للحصول على المعرّف الخاص بك.</p>
        </div>

      </div>
    </div>
  </div>

  <script src="../js/countries.js"></script>

  <script>
    // **تم تحديث هذا الرابط للرابط الأخير الذي قدمته**
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxYQ6LMN0q19NAs2G6MgyaeZVhf65lRGNNH4F9saXphvb1VB4TL3YccgHwwzri9wljmLQ/exec';
    const WHATSAPP_NUMBER = '967778185189'; // رقم الواتساب الذي تريد الإرسال إليه

    const acceptCheckbox = document.getElementById('acceptCheckbox');
    const termsSection = document.getElementById('termsSection');
    const signupForm = document.getElementById('signupForm');
    const backBtn = document.getElementById('backBtn');
    const countrySelect = document.getElementById('country');
    const submitBtn = document.getElementById('submitBtn'); 
    const successBox = document.getElementById('successBox');
    const errorBox = document.getElementById('errorBox');
    const welcomeMessage = document.getElementById('welcomeMessage'); // العنصر الجديد

    // 🟢 التعديل رقم 1: التحقق من حالة التسجيل عند تحميل الصفحة
    if (localStorage.getItem('marketer_registered') === 'true') {
        termsSection.style.display = 'none';
        signupForm.style.display = 'none';
        welcomeMessage.style.display = 'block'; // إظهار رسالة الترحيب
    } else {
        welcomeMessage.style.display = 'none';
    }
    
    // دالة ملء قائمة البلدان 
    function populateCountries() {
        if (typeof arabCountries !== 'undefined' && Array.isArray(arabCountries)) {
            arabCountries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            });
        } else {
            // قائمة افتراضية في حال عدم تحميل السكريبت
            ['اليمن', 'السعودية', 'الإمارات', 'مصر', 'الأردن', 'فلسطين', 'العراق'].forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            });
        }
    }

    // الدالة المسؤولة عن إظهار قسم الشروط
    function showTermsSection() {
        signupForm.style.display = 'none';
        termsSection.style.display = 'block';
        acceptCheckbox.checked = false; 
        window.scrollTo({top:0,behavior:'smooth'});
    }

    // معالج حدث الـ Checkbox (تأخير 2 ثانية)
    acceptCheckbox.addEventListener('change', () => {
      if (acceptCheckbox.checked) {
        // يتم التأخير قبل إخفاء الشروط وإظهار النموذج
        setTimeout(() => {
            termsSection.style.display = 'none'; 
            signupForm.style.display = 'block'; 
            window.scrollTo({top:0,behavior:'smooth'});
        }, 2000); // 2000 مللي ثانية = 2 ثانية
      } else {
        // عند إلغاء التحديد، نعرض الشروط ونخفي النموذج
        if (signupForm.style.display === 'block') {
            showTermsSection();
        }
      }
    });

    // معالج حدث زر العودة
    backBtn.addEventListener('click', showTermsSection);

    // دالة إنشاء رسالة واتساب - تم التعديل لتضمين ID ورابط الإحالة
    function buildWhatsAppMessage(data) {
        // التحقق من وجود المعرف (ID) ورابط الإحالة المرسلة من Apps Script
        const affiliateLink = data.affiliate_link || 'لم يتم إنشاء الرابط بعد';
        const marketerID = data.marketer_id || 'N/A';
        const status = data.marketer_id ? 'N (بانتظار التفعيل)' : 'خطأ في المعرف';

        let message = `*طلب تسجيل مُسوّق جديد*\n\n`;
        message += `*المؤسسة:* كن أنت للتدريب والتأهيل\n`;
        message += `*الاسم:* ${data.fullname}\n`;
        message += `*الجنس:* ${data.gender}\n`;
        message += `*البلد:* ${data.country}\n`;
        message += `*الهاتف:* ${data.phone}\n`;
        message += `*البريد:* ${data.email}\n`;
        message += `---------------------------------\n`;
        message += `*معرّف المسوّق:* ${marketerID}\n`; // إضافة المعرف
        message += `*رابط الإحالة:* ${affiliateLink}\n`; // إضافة رابط الإحالة
        message += `*الحالة:* ${status}\n`; // إضافة الحالة
        message += `---------------------------------\n`;
        message += `*يرجى تأكيد استلام البيانات وتفعيل المعرّف.*`;
        return encodeURIComponent(message);
    }

    // معالج حدث إرسال النموذج - تم تعديل طريقة بناء البيانات لـ Apps Script
    signupForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      errorBox.style.display = 'none';
      submitBtn.disabled = true; // تعطيل الزر مؤقتاً أثناء الإرسال
      const phoneInput = document.getElementById('phone');
      phoneInput.value = phoneInput.value.replace(/[\s\D]/g, ''); 
      


      // البيانات التي ستُرسل إلى Apps Script
      const dataToSend = {
        fullname: document.getElementById('fullname').value.trim(),
        gender: document.getElementById('gender').value,
        country: document.getElementById('country').value,
        phone: document.getElementById('phone').value.trim(),
        email: document.getElementById('email').value.trim(),
      };

      try {
        // **التعديل الهام: استخدام URLSearchParams لضمان قراءة Apps Script لـ e.parameter**
        const urlParams = new URLSearchParams();
        for (const k in dataToSend) {
            urlParams.append(k, dataToSend[k]);
        }

        // 1. الإرسال إلى Google Apps Script
        const resp = await fetch(SCRIPT_URL, { 
            method: 'POST', 
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded' // Header الصحيح لهذا النوع من الإرسال
            },
            body: urlParams.toString() // إرسال السلسلة النصية
        });

        if (!resp.ok) throw new Error('خطأ في الشبكة: ' + resp.status);

        // 2. قراءة الاستجابة كـ JSON
        const result = await resp.json();
        
        if (result.status !== 'success') {
             // إذا كان Apps Script أرجع خطأ (مثل خطأ في ورقة العمل)
             throw new Error(result.message || 'فشل في تسجيل البيانات على السيرفر.');
        }
        
        // 🟢 التعديل رقم 2: الحفظ في ذاكرة المتصفح بعد النجاح
        localStorage.setItem('marketer_registered', 'true');


        // دمج البيانات الأصلية مع المعرف والرابط المرسل من Apps Script
        const fullData = {
            ...dataToSend, 
            marketer_id: result.marketer_id,       
            affiliate_link: result.affiliate_link 
        };

        // 3. نجاح الإرسال: إظهار رسالة النجاح وتعطيل النموذج
        successBox.style.display = 'block';
        signupForm.style.pointerEvents = 'none'; // تعطيل التفاعل مع النموذج بالكامل

        // 4. توجيه المستخدم إلى واتساب
        const whatsappMsg = buildWhatsAppMessage(fullData);
        const whatsappUrl = `https://wa.me/${WHATSAPP_NUMBER}?text=${whatsappMsg}`;


        // التوجيه بعد تأخير بسيط لإتاحة قراءة رسالة النجاح
window.location.href = whatsappUrl; 

        
        
      } 
      catch (err) {
        // فشل الإرسال (سواء خطأ شبكة أو خطأ من Apps Script)
        submitBtn.disabled = false; // إعادة تفعيل الزر للمحاولة مرة أخرى
        errorBox.style.display = 'block';
        errorBox.textContent = 'حدث خطأ أثناء الإرسال: ' + err.message + '\nتأكد من نشر Apps Script كـ Web App مع السماح بالوصول للجميع.';
      }
    });


    // استدعاء دالة ملء البلدان عند تحميل الصفحة
    document.addEventListener('DOMContentLoaded', populateCountries);
  </script>
</body>
</html>


